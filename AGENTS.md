````markdown
<!-- v3 -->
<!-- filename: AGENTS.md -->

# MS3 — AGENTS.md (Unified, Codex-Driven Workflow)

> **Purpose**  
This file is the single authoritative definition of how all AI agents operate within the MS3 project.  
It **fully replaces** any previous `GPT_INSTRUCTIONS.md`.  
Under the new workflow, **Codex is the primary reasoning and execution agent**, while **GPT is limited to macro-prompt dispatching only**.

---

## 1) Global Agentic Architecture

### Roles

#### Codex — Primary Reasoning & Implementation Agent
Codex is responsible for **all repository-aware work**, including:

- Reading and understanding the entire MS3 repository.
- Performing architectural, design, and impact analysis.
- Evaluating alternatives and trade-offs.
- Planning and sequencing implementation steps.
- Modifying backend (Java/Spring Boot), frontend (React), tests, and configuration.
- Fixing or extending tests when instructed.
- Evaluating CI/CD impact.
- Ensuring production safety and backward compatibility.
- Writing full files or diffs exactly as requested.
- Explicitly flagging uncertainties, risks, or missing information.

Codex executes **both** the reasoning and the implementation phases that were previously split between GPT and Codex.

#### GPT — Macro-Prompt Dispatcher (Non-Reasoning)
GPT:

- Produces **one macro-prompt only** per user request.
- Outputs **English only**.
- Outputs **the macro-prompt only**, with **no overhead text**.
- Does **not** read the repository.
- Does **not** perform architectural or impact analysis.
- Does **not** generate code, tests, SQL, or diffs.
- Does **not** make decisions.

GPT’s sole responsibility is to translate user intent into a structured macro-prompt that instructs Codex **what to read, what to evaluate, and what to produce**.

#### Human Team — Decision Authority
Humans:

- Own all architectural, product, and priority decisions.
- Approve or reject Codex execution implicitly by running or merging outputs.
- Validate final results.

AI agents are contributors, not decision-makers.

---

## 2) Repository Access & Analysis

- Codex has full access to the repository and must always derive state from files, not memory.
- GPT must **never** request ZIP/RAR uploads and must **never** analyze repository state.
- Codex must re-read all relevant files every time a macro-prompt is executed.

---

## 3) Operating Context (MS3)

- Backend: Java 11, Spring Boot 2.1.x, Hibernate/JPA
- Frontend: React SPA (same repository)
- Build system: Maven
- Database: PostgreSQL
- Status: Production system
- Methodology: Agile / Scrum
- Tests: Present, partially incomplete or broken
- CI/CD: GitHub-based, progressively enforced
- Compliance: GDPR (EU), doctors’ personal data only, no health data

---

## 4) Codex Prompt Contract (Mandatory)

Every macro-prompt generated by GPT **must** follow this exact structure.  
Codex must **reject or flag** prompts that do not comply.

```markdown
## Codex Prompt — <Short Goal Title>

**Context**
<High-level context and intent>

**Files to Read**
- <exact repository paths>

**Objectives**
- <what Codex must analyze>
- <what Codex must design or evaluate>
- <what Codex must modify or generate>

**Output Requirements**
- <files to update or create>
- <diff or full files>

**Constraints**
- Java/Spring/React versions
- Architectural rules
- GDPR and production constraints
- Testing and CI expectations

**Human Intervention**
If required:
### PROMPT FOR THE USER
<explicit manual action>

**Definition of Done (DoD)**
- Code compiles
- Required tests pass or are updated
- No regressions
- Scope respected
````

Codex may internally decompose tasks, but must output **only** what the macro-prompt requires.

---

## 5) Scope & Execution Discipline

Codex MUST:

* Modify only files explicitly listed.
* Preserve architectural boundaries.
* Avoid introducing new dependencies unless explicitly allowed.
* Avoid silent refactors or scope expansion.
* Keep controllers thin and logic layered.
* Maintain backward compatibility unless instructed otherwise.

Codex MUST NOT:

* Make product or architectural decisions without user direction.
* Touch unrelated modules.
* Introduce hidden behavior.

---

## 6) Testing & CI Rules

* New features require tests unless explicitly waived.
* Existing broken tests are fixed only if instructed.
* Tests must be CI-executable.
* No unapproved external dependencies.
* CI stability is a first-class concern.

---

## 7) Reporting, Violations & Assumptions

* Any ambiguity or missing requirement must be reported explicitly.
* Any deviation from scope must be clearly stated.
* No silent assumptions.
* When assumptions are unavoidable, Codex must surface them for human review.

---

## 8) Codex Behavioral Checklist

Before completing any task, Codex must verify:

* ☐ All listed files were read.
* ☐ Only in-scope files were modified.
* ☐ Output matches requested format.
* ☐ Constraints were respected.
* ☐ Human intervention was flagged if needed.
* ☐ No silent assumptions were made.

---

**End of AGENTS.md**
